<html py:extends="master.xhtml" py:strip="True">

<head py:block="head" py:strip="True">
    <title py:block="master_title">${tmpl_context.title} - ${model} Listing</title>
    <script src="https://ajax.googleapis.com/ajax/libs/angularjs/1.7.7/angular.min.js"></script>
    <script src="${tg.url('/javascript/app/ng-file-upload-shim.min.js')}"></script>
    <script src="${tg.url('/javascript/app/ng-file-upload.min.js')}"></script>
    <script src="${tg.url('/javascript/app/app.js')}"></script>
    <script src="${tg.url('/javascript/app/photolist-controller.js')}"></script>
</head>

<body py:block="body" py:strip="True">
    <div id="crud_leftbar">
        <ul id="menu_items" py:if="hasattr(tmpl_context, 'menu_items')">
            <li py:for="lower, item in sorted(tmpl_context.menu_items.items())">
                <a href="${tmpl_context.crud_helpers.make_link(lower)}">$item</a>
            </li>
        </ul>
    </div>
    <div id="crud_content">
    	<div class="row">
      	<div class="col-md-6 col-xs-12">
      		<h1>$model Listing</h1>
      	</div>
      	<div class="col-md-6 col-xs-12">
	      		<a class="btn btn-primary pull-right" href="/contacts/json_data" 
	      			style="margin-top: 18px;" target="_blank">
	      			Export all contacts
	      		</a>
      	</div>
      </div>
      <div id="crud_btn_new">
        <a href='${tg.url("new", params=tmpl_context.kept_params)}' class="add_link">New $model</a>
        <span py:if="value_list" py:content="tmpl_context.paginators.value_list.pager(link=mount_point+'/')"/>
        <div py:if="search_fields" id="crud_search">
            <form>
                <select id="crud_search_field" onchange="crud_search_field_changed(this);">
                  <py:for each="field, name, selected in search_fields" py:switch="selected">
                    <option py:case="False" value="${field}">${name}</option>
                    <option py:else="" value="${field}" selected="selected">${name}</option>
                  </py:for>
                </select>
                <input id="crud_search_value" name="${current_search[0]}" type="text" placeholder="equals / contains" value="${current_search[1]}" />
                <input type="submit" value="Search"/>
            </form>
        </div>
      </div>
      <div class="table-responsive">
        <div xmlns:py="http://genshi.edgewall.org/" ng-app="addPhoto">
          <table class="table table-striped" ng-controller="PhotoListController as vm">
            <thead>
              <tr>
                <th class="col_0">
                    actions
                </th>
                <th class="col_1">
                  <a href="/contacts/?order_by=contact_name">
                    contact_name
                  </a>
                </th>
                <th class="col_2">
                  <a href="/contacts/?order_by=contact_phonenumber">
                    contact_phonenumber
                  </a>
                </th>
                <th class="col_3">
                  <a href="/contacts/?order_by=image">
                    image
                  </a>
                </th>
              </tr>
            </thead>
            <tbody>
              <tr py:for="item in value_list">
                <td class="col_0">
                  <a href="${item['id']}/edit" class="btn btn-primary">
                    <span class="glyphicon glyphicon-pencil"></span>
                  </a>
                  <div class="hidden-lg hidden-md">&nbsp;</div>
                  <form method="POST" action="${item['id']}" style="display: inline">
                    <input type="hidden" name="_method" value="DELETE" />
                    <button type="submit" class="btn btn-danger" 
                        onclick="return confirm('Are you sure?')">
                      <span class="glyphicon glyphicon-trash"></span>
                    </button>
                  </form>
                </td>
                <td class="col_1">
                  ${item['contact_name']}
                </td>
                <td class="col_2">
                  ${item['contact_phonenumber']}
                </td>
                <td class="col_3">
                  <py:choose test="${item['image']}">
                    <py:when test='None'>
                      <button class="btn btn-primary" 
                          ngf-select="vm.upload($$files, ${item['id']})"
                          ngf-multiple="false">
                        <span class="glyphicon glyphicon-plus"></span>
                      </button>
                    </py:when>
                    <py:otherwise>
                      ${item['image']}
                      <button class="btn btn-primary" 
                          ngf-select="vm.upload($$files, ${item['id']})"
                          ngf-multiple="false">
                        <span class="glyphicon glyphicon-edit"></span>
                      </button>
                      <button class="btn btn-danger" 
                          ng-click="vm.delete(${item['id']})">
                        <span class="glyphicon glyphicon-trash"></span>
                      </button>
                    </py:otherwise>
                  </py:choose>
                </td>
              </tr>
            </tbody>
          </table>
        </div>
      </div>
    </div>
    <div style="clear:both;"/>
</body>
</html>
